require(geoR)
require(lattice)
library(rasterVis)

source("grafico_limari_v2_includes.R")
#configuración
limite = 0.40 #corresponde al quantil de límite crítico 
workdir <- "C:/Users/Pablo/Dropbox/cazalac/Simgen-Limari v2/simgen/otros_scripts"
setwd(workdir)
#rango de pp y temperatura, malla generada en python, no modificar.
pp <- c(101.543928571,101.543928571,101.543928571,101.543928571,101.543928571,101.543928571,101.543928571,101.543928571,101.543928571,101.543928571,101.543928571,101.543928571,101.543928571,101.543928571,101.543928571,101.543928571,101.543928571,118.467916667,118.467916667,118.467916667,118.467916667,118.467916667,118.467916667,118.467916667,118.467916667,118.467916667,118.467916667,118.467916667,118.467916667,118.467916667,118.467916667,118.467916667,118.467916667,118.467916667,135.391904762,135.391904762,135.391904762,135.391904762,135.391904762,135.391904762,135.391904762,135.391904762,135.391904762,135.391904762,135.391904762,135.391904762,135.391904762,135.391904762,135.391904762,135.391904762,135.391904762,152.315892857,152.315892857,152.315892857,152.315892857,152.315892857,152.315892857,152.315892857,152.315892857,152.315892857,152.315892857,152.315892857,152.315892857,152.315892857,152.315892857,152.315892857,152.315892857,152.315892857,169.239880952,169.239880952,169.239880952,169.239880952,169.239880952,169.239880952,169.239880952,169.239880952,169.239880952,169.239880952,169.239880952,169.239880952,169.239880952,169.239880952,169.239880952,169.239880952,169.239880952,186.163869048,186.163869048,186.163869048,186.163869048,186.163869048,186.163869048,186.163869048,186.163869048,186.163869048,186.163869048,186.163869048,186.163869048,186.163869048,186.163869048,186.163869048,186.163869048,186.163869048,203.087857143,203.087857143,203.087857143,203.087857143,203.087857143,203.087857143,203.087857143,203.087857143,203.087857143,203.087857143,203.087857143,203.087857143,203.087857143,203.087857143,203.087857143,203.087857143,203.087857143,220.011845238,220.011845238,220.011845238,220.011845238,220.011845238,220.011845238,220.011845238,220.011845238,220.011845238,220.011845238,220.011845238,220.011845238,220.011845238,220.011845238,220.011845238,220.011845238,220.011845238,236.935833333,236.935833333,236.935833333,236.935833333,236.935833333,236.935833333,236.935833333,236.935833333,236.935833333,236.935833333,236.935833333,236.935833333,236.935833333,236.935833333,236.935833333,236.935833333,236.935833333)
tt <- c(8.54601190476,9.54601190476,10.5460119048,11.5460119048,12.5460119048,13.5460119048,14.5460119048,15.5460119048,16.5460119048,17.5460119048,18.5460119048,19.5460119048,20.5460119048,21.5460119048,22.5460119048,23.5460119048,24.5460119048,8.54601190476,9.54601190476,10.5460119048,11.5460119048,12.5460119048,13.5460119048,14.5460119048,15.5460119048,16.5460119048,17.5460119048,18.5460119048,19.5460119048,20.5460119048,21.5460119048,22.5460119048,23.5460119048,24.5460119048,8.54601190476,9.54601190476,10.5460119048,11.5460119048,12.5460119048,13.5460119048,14.5460119048,15.5460119048,16.5460119048,17.5460119048,18.5460119048,19.5460119048,20.5460119048,21.5460119048,22.5460119048,23.5460119048,24.5460119048,8.54601190476,9.54601190476,10.5460119048,11.5460119048,12.5460119048,13.5460119048,14.5460119048,15.5460119048,16.5460119048,17.5460119048,18.5460119048,19.5460119048,20.5460119048,21.5460119048,22.5460119048,23.5460119048,24.5460119048,8.54601190476,9.54601190476,10.5460119048,11.5460119048,12.5460119048,13.5460119048,14.5460119048,15.5460119048,16.5460119048,17.5460119048,18.5460119048,19.5460119048,20.5460119048,21.5460119048,22.5460119048,23.5460119048,24.5460119048,8.54601190476,9.54601190476,10.5460119048,11.5460119048,12.5460119048,13.5460119048,14.5460119048,15.5460119048,16.5460119048,17.5460119048,18.5460119048,19.5460119048,20.5460119048,21.5460119048,22.5460119048,23.5460119048,24.5460119048,8.54601190476,9.54601190476,10.5460119048,11.5460119048,12.5460119048,13.5460119048,14.5460119048,15.5460119048,16.5460119048,17.5460119048,18.5460119048,19.5460119048,20.5460119048,21.5460119048,22.5460119048,23.5460119048,24.5460119048,8.54601190476,9.54601190476,10.5460119048,11.5460119048,12.5460119048,13.5460119048,14.5460119048,15.5460119048,16.5460119048,17.5460119048,18.5460119048,19.5460119048,20.5460119048,21.5460119048,22.5460119048,23.5460119048,24.5460119048,8.54601190476,9.54601190476,10.5460119048,11.5460119048,12.5460119048,13.5460119048,14.5460119048,15.5460119048,16.5460119048,17.5460119048,18.5460119048,19.5460119048,20.5460119048,21.5460119048,22.5460119048,23.5460119048,24.5460119048)
#nombre del gráfico
var <- "Embalse Paloma"

###modificación 09-02-2018
##Agrega promedios de simgen

#Directorio de Trabajo




#Dos puntos a agregar, agregar de histórico a proyectado.

#Percentil 95 de todas las simulaciones
#2030 - 2060 porque está como > y <
p95 <- promedios(workdir = "C:/Users/Pablo/Dropbox/cazalac/Simgen-Limari v2/simgen/output_sim/anual", nums = c(95), anhoinicio = 2029, anhofinal = 2061)
p95.vectorpp <- c(do.call("cbind",p95[1])) 
p95.vectortt <- c(do.call("cbind",p95[2])) 

#percentil 50
p50 <- promedios(workdir = "C:/Users/Pablo/Dropbox/cazalac/Simgen-Limari v2/simgen/output_sim/anual", nums = c(50), anhoinicio = 2029, anhofinal = 2061)
p50.vectorpp <- c(do.call("cbind",p50[1])) 
p50.vectortt <- c(do.call("cbind",p50[2])) 

#percentil 10
p10 <- promedios(workdir = "C:/Users/Pablo/Dropbox/cazalac/Simgen-Limari v2/simgen/output_sim/anual", nums = c(10), anhoinicio = 2029, anhofinal = 2061)
p10.vectorpp <- c(do.call("cbind",p10[1])) 
p10.vectortt <- c(do.call("cbind",p10[2])) 


promedioproyectadott <- (mean(as.numeric(p95.vectortt))+mean(as.numeric(p50.vectortt))+mean(as.numeric(p10.vectortt)))/3
promedioproyectadopp <- (mean(as.numeric(p95.vectorpp))+mean(as.numeric(p50.vectorpp))+mean(as.numeric(p10.vectorpp)))/3

#corresponde a la coordenada X de los puntos 
puntosx <- c(167.473887814,promedioproyectadopp,p95.vectorpp,p50.vectorpp,p10.vectorpp)
#corresponde a la coordenada Y de los puntos
puntosy <- c(16.8596276476,promedioproyectadott, p95.vectortt,p50.vectortt, p10.vectortt)


#rellenamos
p95.phcpuntos <- vector('numeric')
p95.typos  <- vector('numeric')
p10.phcpuntos <- vector('numeric')
p10.typos  <- vector('numeric')
p50.phcpuntos <- vector('numeric')
p50.typos  <- vector('numeric')
for (variable in 1:length(p95.vectorpp)) {
  p95.phcpuntos <- c(p95.phcpuntos, 0)
  p95.typos <- c(p95.typos, "p")
}
for (variable in 1:length(p50.vectorpp)) {
  p50.phcpuntos <- c(p50.phcpuntos, 1)
  p50.typos <- c(p50.typos, "p")
}
for (variable in 1:length(p10.vectorpp)) {
  p10.phcpuntos <- c(p10.phcpuntos, 2)
  p10.typos <- c(p10.typos, "p")
}
#corresponde al tipo de punto a colocar en el gráfico
pchpuntos <- c(4,19,p95.phcpuntos,p50.phcpuntos,p10.phcpuntos)
typos <- c("p","p",p95.typos,p50.typos,p10.typos)

#Mallas Generadas

#####ORIGINAL#########
#pp <- c(120.00,	120.00,	120.00,	120.00,	120.00,	120.00,	120.00,	120.00,	120.00,	120.00,	120.00,	120.00,	120.00,	120.00,	140.00,	140.00,	140.00,	140.00,	140.00,	140.00,	140.00,	140.00,	140.00,	140.00,	140.00,	140.00,	140.00,	140.00,	160.00,	160.00,	160.00,	160.00,	160.00,	160.00,	160.00,	160.00,	160.00,	160.00,	160.00,	160.00,	160.00,	160.00,	180.00,	180.00,	180.00,	180.00,	180.00,	180.00,	180.00,	180.00,	180.00,	180.00,	180.00,	180.00,	180.00,	180.00,	200.00,	200.00,	200.00,	200.00,	200.00,	200.00,	200.00,	200.00,	200.00,	200.00,	200.00,	200.00,	200.00,	200.00,	220.00,	220.00,	220.00,	220.00,	220.00,	220.00,	220.00,	220.00,	220.00,	220.00,	220.00,	220.00,	220.00,	220.00,	240.00,	240.00,	240.00,	240.00,	240.00,	240.00,	240.00,	240.00,	240.00,	240.00,	240.00,	240.00,	240.00,	240.00,	260.00,	260.00,	260.00,	260.00,	260.00,	260.00,	260.00,	260.00,	260.00,	260.00,	260.00,	260.00,	260.00,	260.00,	280.00,	280.00,	280.00,	280.00,	280.00,	280.00,	280.00,	280.00,	280.00,	280.00,	280.00,	280.00,	280.00,	280.00)
#tt <- c(12.00,	13.00,	14.00,	16.00,	19.00,	20.00,	21.00,	22.00,	23.00,	24.00,	25.00,	26.00,	27.00,	28.00,	12.00,	13.00,	14.00,	16.00,	19.00,	20.00,	21.00,	22.00,	23.00,	24.00,	25.00,	26.00,	27.00,	28.00,	12.00,	13.00,	14.00,	16.00,	19.00,	20.00,	21.00,	22.00,	23.00,	24.00,	25.00,	26.00,	27.00,	28.00,	12.00,	13.00,	14.00,	16.00,	19.00,	20.00,	21.00,	22.00,	23.00,	24.00,	25.00,	26.00,	27.00,	28.00,	12.00,	13.00,	14.00,	16.00,	19.00,	20.00,	21.00,	22.00,	23.00,	24.00,	25.00,	26.00,	27.00,	28.00,	12.00,	13.00,	14.00,	16.00,	19.00,	20.00,	21.00,	22.00,	23.00,	24.00,	25.00,	26.00,	27.00,	28.00,	12.00,	13.00,	14.00,	16.00,	19.00,	20.00,	21.00,	22.00,	23.00,	24.00,	25.00,	26.00,	27.00,	28.00,	12.00,	13.00,	14.00,	16.00,	19.00,	20.00,	21.00,	22.00,	23.00,	24.00,	25.00,	26.00,	27.00,	28.00,	12.00,	13.00,	14.00,	16.00,	19.00,	20.00,	21.00,	22.00,	23.00,	24.00,	25.00,	26.00,	27.00,	28.00)
#cc <- c(68.02,	72.36,	77.50,	87.01,	84.65,	83.04,	81.67,	80.13,	79.04,	77.73,	76.62,	75.63,	74.97,	74.43,	72.44,	78.01,	84.64,	97.35,	94.93,	92.87,	91.17,	89.32,	87.99,	86.44,	85.09,	83.91,	83.58,	83.06,	77.31,	83.96,	92.44,	108.43,	106.13,	103.77,	101.75,	99.63,	98.03,	96.13,	94.48,	93.13,	92.19,	92.06,	82.44,	90.29,	101.08,	120.12,	118.35,	115.64,	113.31,	110.76,	108.93,	106.71,	104.79,	103.15,	102.59,	101.99,	87.92,	96.97,	109.23,	132.53,	133.24,	131.45,	128.38,	125.75,	122.85,	120.81,	118.38,	116.23,	114.27,	113.35,	93.76,	104.02,	118.06,	145.64,	145.14,	141.79,	138.77,	135.52,	133.15,	130.34,	127.86,	125.51,	124.87,	124.27,	99.90,	111.47,	127.30,	159.06,	159.37,	155.83,	152.78,	149.29,	146.73,	143.49,	140.92,	138.42,	137.14,	136.64,	106.22,	119.20,	136.58,	172.90,	174.38,	170.57,	167.41,	163.48,	160.62,	156.82,	153.98,	151.22,	149.67,	149.79,	112.69,	127.10,	145.94,	187.11,	190.08,	186.01,	182.85,	178.59,	175.52,	171.41,	168.39,	165.32,	163.84,	163.57)
#####FIN ORIGINAL#####
#3 embalses
#agua potable
#sector riego, cultivo multi anual

##################
##WEAP 1971-1985 TOTAL NODE INFLOW (CATCHMENT INFLOW NODE 75)
##################
#pp <- c(101.543928571,101.543928571,101.543928571,101.543928571,101.543928571,101.543928571,101.543928571,101.543928571,101.543928571,101.543928571,101.543928571,101.543928571,101.543928571,101.543928571,101.543928571,101.543928571,101.543928571,118.467916667,118.467916667,118.467916667,118.467916667,118.467916667,118.467916667,118.467916667,118.467916667,118.467916667,118.467916667,118.467916667,118.467916667,118.467916667,118.467916667,118.467916667,118.467916667,118.467916667,135.391904762,135.391904762,135.391904762,135.391904762,135.391904762,135.391904762,135.391904762,135.391904762,135.391904762,135.391904762,135.391904762,135.391904762,135.391904762,135.391904762,135.391904762,135.391904762,135.391904762,152.315892857,152.315892857,152.315892857,152.315892857,152.315892857,152.315892857,152.315892857,152.315892857,152.315892857,152.315892857,152.315892857,152.315892857,152.315892857,152.315892857,152.315892857,152.315892857,152.315892857,169.239880952,169.239880952,169.239880952,169.239880952,169.239880952,169.239880952,169.239880952,169.239880952,169.239880952,169.239880952,169.239880952,169.239880952,169.239880952,169.239880952,169.239880952,169.239880952,169.239880952,186.163869048,186.163869048,186.163869048,186.163869048,186.163869048,186.163869048,186.163869048,186.163869048,186.163869048,186.163869048,186.163869048,186.163869048,186.163869048,186.163869048,186.163869048,186.163869048,186.163869048,203.087857143,203.087857143,203.087857143,203.087857143,203.087857143,203.087857143,203.087857143,203.087857143,203.087857143,203.087857143,203.087857143,203.087857143,203.087857143,203.087857143,203.087857143,203.087857143,203.087857143,220.011845238,220.011845238,220.011845238,220.011845238,220.011845238,220.011845238,220.011845238,220.011845238,220.011845238,220.011845238,220.011845238,220.011845238,220.011845238,220.011845238,220.011845238,220.011845238,220.011845238,236.935833333,236.935833333,236.935833333,236.935833333,236.935833333,236.935833333,236.935833333,236.935833333,236.935833333,236.935833333,236.935833333,236.935833333,236.935833333,236.935833333,236.935833333,236.935833333,236.935833333)
#tt <- c(8.54601190476,9.54601190476,10.5460119048,11.5460119048,12.5460119048,13.5460119048,14.5460119048,15.5460119048,16.5460119048,17.5460119048,18.5460119048,19.5460119048,20.5460119048,21.5460119048,22.5460119048,23.5460119048,24.5460119048,8.54601190476,9.54601190476,10.5460119048,11.5460119048,12.5460119048,13.5460119048,14.5460119048,15.5460119048,16.5460119048,17.5460119048,18.5460119048,19.5460119048,20.5460119048,21.5460119048,22.5460119048,23.5460119048,24.5460119048,8.54601190476,9.54601190476,10.5460119048,11.5460119048,12.5460119048,13.5460119048,14.5460119048,15.5460119048,16.5460119048,17.5460119048,18.5460119048,19.5460119048,20.5460119048,21.5460119048,22.5460119048,23.5460119048,24.5460119048,8.54601190476,9.54601190476,10.5460119048,11.5460119048,12.5460119048,13.5460119048,14.5460119048,15.5460119048,16.5460119048,17.5460119048,18.5460119048,19.5460119048,20.5460119048,21.5460119048,22.5460119048,23.5460119048,24.5460119048,8.54601190476,9.54601190476,10.5460119048,11.5460119048,12.5460119048,13.5460119048,14.5460119048,15.5460119048,16.5460119048,17.5460119048,18.5460119048,19.5460119048,20.5460119048,21.5460119048,22.5460119048,23.5460119048,24.5460119048,8.54601190476,9.54601190476,10.5460119048,11.5460119048,12.5460119048,13.5460119048,14.5460119048,15.5460119048,16.5460119048,17.5460119048,18.5460119048,19.5460119048,20.5460119048,21.5460119048,22.5460119048,23.5460119048,24.5460119048,8.54601190476,9.54601190476,10.5460119048,11.5460119048,12.5460119048,13.5460119048,14.5460119048,15.5460119048,16.5460119048,17.5460119048,18.5460119048,19.5460119048,20.5460119048,21.5460119048,22.5460119048,23.5460119048,24.5460119048,8.54601190476,9.54601190476,10.5460119048,11.5460119048,12.5460119048,13.5460119048,14.5460119048,15.5460119048,16.5460119048,17.5460119048,18.5460119048,19.5460119048,20.5460119048,21.5460119048,22.5460119048,23.5460119048,24.5460119048,8.54601190476,9.54601190476,10.5460119048,11.5460119048,12.5460119048,13.5460119048,14.5460119048,15.5460119048,16.5460119048,17.5460119048,18.5460119048,19.5460119048,20.5460119048,21.5460119048,22.5460119048,23.5460119048,24.5460119048)
#cc <- c(64520618.1875,68579604.4375,73362642.25,78364761.625,82208335.625,82152590.0625,81215931.5625,79860211.6875,78327140.875,77065477.4375,75635483.0625,74636727.4375,73441331.4375,72425307.125,71550094.5,70960968.6875,70492804.9375,68664254.0625,73880072.4375,80062344.75,86666287.0625,91904972.75,92049637.75,91060754.6875,89487809.4375,87564980.375,85991461.6875,84275394.125,83044978.75,81625363.6875,80372202.0,79323689.3125,78627602.3125,78113164.875,73226742.0,79455329.4375,87374499.6875,95603983.25,102304729.812,102751402.562,101713941.438,100012838.938,97775750.75,95933097.0625,93934698.9375,92473108.875,90734507.9375,89208074.125,88002464.4375,87165047.9375,86585763.375,78035168.8125,85386325.8125,95104009.875,105021218.938,113269168.062,114287441.562,113207660.875,111467501.75,108921772.375,106778828.0,104396435.5,102724035.25,100689451.312,98894511.25,97401104.25,96510260.5625,95932684.5,83173753.0,91650299.25,103122412.062,115301163.562,124909275.125,126505085.125,125498463.75,123781312.688,120866858.75,118384808.375,115615668.25,113694888.562,111390365.75,109336789.562,107510485.375,106628984.438,106015064.75,88644128.0625,98263696.6875,111404297.125,126255751.625,137202503.438,139367493.25,138424474.438,136613379.312,133457341.312,130679281.188,127656756.375,125458399.0,122880108.0,120570394.25,118445350.688,117464554.75,116889817.188,94405190.9375,105253134.25,120073162.625,137513647.438,149786422.812,152424932.812,151539478.75,149959021.562,146643186.375,143761195.625,140461849.0,138020373.938,134988923.125,132540757.125,130171472.438,128999515.75,128519973.188,100329553.625,112500365.875,128777933.875,149186751.938,162774534.312,165815257.438,165173894.188,164050369.312,160469173.312,157557531.438,153905199.5,151246794.312,147756086.812,145120806.562,142559000.938,141226843.75,140887262.062,106396324.125,119906887.125,137550291.938,161095251.875,176095899.0,179849579.062,179246243.5,178774830.438,174964918.812,171980571.062,167973584.188,165055821.562,161212191.438,158353351.625,155431008.562,154109314.875,153844297.688)
#cc <- cc/1000000

#########################################
## VOLUMEN DE EMBALSES
#########################################
# Volumen Embalse-Cogoti
#cc <- c(18087521.0365,20453193.974,22993124.8005,19783029.987,18717663.4797,15709143.5964,13879739.6521,12373020.3432,11368571.7411,10164460.3005,9316621.45573,8609664.15625,8057086.05208,7469009.98177,6943364.52604,6687399.40365,6325633.04167,28382834.9349,33258740.6562,39566166.0745,35253645.0589,32991931.3698,27679618.4469,23935846.0469,21030384.4052,18990664.4109,16910106.1562,15455448.7969,14070255.4589,13332458.2656,12612898.4609,11783616.3828,11410626.2682,10702641.9557,50451504.3099,69268811.7839,84797801.9349,77615839.1458,69106732.2448,53400951.2109,42406213.0036,36465330.4906,32441031.4573,28956763.6797,26211865.5208,23817113.5969,22194388.0984,20547141.25,19060059.349,18571294.4083,17514791.7021,95198945.2995,102956941.198,112269049.469,106435928.927,100643533.453,88483514.9089,77634144.3594,65885881.5953,57382211.1979,48915441.8516,43264034.5667,38944931.4609,36563456.4516,34004405.1766,31651255.8464,30464127.4323,28492616.1125,120177078.19,120542999.102,122942983.664,119254455.943,116363758.266,111012965.375,104969381.193,95946925.724,85869388.2578,77207044.0,67648174.4609,60487254.1641,55355261.0766,51123533.8906,47114659.8776,44007717.7161,41469259.8661,124078894.354,125902930.521,126844707.258,125244783.346,123469000.12,119958299.784,116074960.917,111463886.672,106312412.677,101157085.786,94343539.8542,86006471.1432,78452856.1589,70995888.7552,63782748.8151,58013480.3073,53637758.7474,126103361.891,127672547.385,128677349.396,128547607.875,127535422.706,124984326.755,122633250.315,119740945.125,115567445.659,112051376.417,107714322.279,102838778.266,97964722.9792,92841737.3229,86673543.2318,78695912.6589,71467050.7734,127511420.81,128917059.638,129885548.078,129930373.938,129646766.604,128546776.273,126641554.839,124354683.276,121807113.43,119139778.328,115107543.224,111454111.047,107789849.07,104355607.987,100651563.146,95537887.8828,90168619.526,128636158.552,129939248.016,130846426.448,130869607.115,130712830.323,130151088.534,129334516.789,127978326.023,125829930.922,123678972.648,120660142.201,117627908.122,114387567.232,110839517.164,108144789.656,104813144.448,101633252.583)
#cc <- cc/1000000
#Volumen Embalse-Paloma
cc <- c(126627644.549,140369072.091,155674518.242,136991308.966,130071172.948,111451503.057,98139447.4714,87863475.388,81025940.3255,73810185.9453,68586935.6823,64494858.3672,61539894.4427,58899247.1641,56719542.0365,55770649.9375,53164024.7839,182410677.622,217492268.417,253220035.909,234176491.357,219637429.484,187030929.505,160817099.177,141443968.703,128047664.638,115605357.789,106329429.047,98269284.6927,93685908.9297,89328794.9505,84958306.651,83777725.4948,79828007.1276,286505403.557,387567080.107,470043479.576,450122849.734,413128445.031,338886686.544,272935729.708,235439112.607,210991895.549,188662173.706,171785315.443,158402872.93,149138275.654,139906977.042,131361056.044,128805215.036,122521311.242,507037029.143,547750630.911,593555972.784,575676604.292,551566684.682,499919349.13,450222345.961,396575865.872,355080909.979,307341582.812,274641575.443,251213492.289,238769367.792,224072414.958,208928375.724,202523780.857,191055234.458,628616473.216,631092453.88,640830602.953,629696539.047,618058426.789,595879624.258,567916135.562,528635895.94,484740682.974,444511901.69,401694311.938,367302277.411,341599089.703,320574434.25,304860311.82,289220158.406,275394412.823,646033365.169,654525618.409,659205224.091,654180037.656,647516231.143,634060221.812,616686713.461,596542762.25,575956144.789,552278243.036,522808371.339,485598008.229,451595058.214,418185639.466,385942343.133,363723622.849,343132269.346,655440471.451,662571267.938,667977674.607,669003534.185,666359770.893,656113512.154,646097161.268,634375598.078,616031464.367,600059355.945,583574329.812,563763405.31,542871857.102,521485261.672,493934607.219,459894444.57,428467262.299,662268681.846,668505894.539,673721571.995,675494309.224,675893413.214,672701225.294,664485264.24,655603669.57,644942867.266,633048686.818,616292322.174,601750410.956,588308143.833,575269935.281,559948499.547,538141969.107,517582503.406,667509626.406,673560640.378,678307663.372,679939363.542,680864836.057,679804255.198,676951763.221,672290386.906,663663472.982,654295661.357,641954048.263,629937765.242,617779958.276,605095726.422,595439485.005,582249883.849,569315744.706)
cc <- cc/1000000
#Volumen Embalse-Recoleta
#cc <- c(10715788.1901,11309551.9792,11924042.6276,12264672.8516,12000584.3185,10073692.0639,8349063.7849,6974489.85417,5846290.92833,4925791.30878,4157068.60394,3548385.33672,3008414.36719,2388028.84714,2013597.46354,1845948.98958,1601162.92187,16353192.3568,19147869.4505,22145651.8073,23901712.0911,23342421.2786,19555407.1276,16161975.9732,13613640.1851,11557899.0573,9864412.23958,8598917.60125,7576013.87041,6821422.69313,6206278.26562,5444232.51302,5180767.6875,4715678.11979,26830140.3672,33282080.487,40337700.6875,43130959.5625,44795710.8281,36284937.75,28903835.4505,24590666.6065,21275984.9425,18422655.6536,15778360.5625,13992973.6458,12730704.0417,11426815.151,10542209.2344,10337620.5599,9737621.64323,44853531.6849,47667766.0208,59780989.1198,65033622.0286,65830817.6667,59013262.1016,50348366.625,41238129.8646,36377848.763,30949599.7995,26849296.7943,24135330.4531,22384344.487,20398617.8828,18376177.375,17885943.5078,17080660.151,67469664.4948,69461364.6745,77046872.3438,77222551.5885,76096452.6198,72625755.1276,68450037.6562,61633725.3776,53775167.6667,45700104.5911,39643627.151,35698722.0312,31929782.2057,29315613.7005,27574078.1901,26513028.0521,25346853.8516,77814594.9062,78395835.2188,80802554.862,81238890.5573,80526278.1042,78725557.0469,75497959.9089,71601692.4974,68273323.4323,63757544.599,57629622.724,50164776.0495,43942874.7083,38696285.6328,34940803.276,33360942.7917,32080897.0208,80478089.6641,80903942.8698,82633088.4557,83359490.2292,83431910.0729,82201034.5443,80262695.4557,77772558.9688,74443043.2396,71327304.9896,67900713.5703,63861411.8333,59321208.6615,54113355.0443,48378919.6302,44359987.2943,41207718.9531,82125860.0208,82453300.5651,83785272.5651,84451134.7135,84885450.4818,84596241.3672,83274454.5339,81562653.5286,79264623.7188,76937514.8464,73908330.388,70745922.3984,67401160.0234,63539898.6849,59856817.3177,56065512.1224,52446014.5938,83286448.0104,83518859.4115,84709011.2188,85301272.6693,85773986.8542,85766164.5443,85126767.1536,84126898.2031,82468342.4948,80518498.8594,78171162.1276,75859234.2422,73208557.1562,69956230.4583,67067973.5521,63456911.7682,60386404.613)
#cc <- cc/1000000
#########################################
## CAUDALES DE ENTRADA A EMBALSES 
#########################################
#Rio Cogoti -> 24\ Reach -> Embalse Cogoti
#cc <- c(68355283.75,74408290.3125,79665854.5,79060701.5,77756220.6875,74065953.25,72186913.4375,69893384.9375,68629996.25,67107235.0,65472117.0,64274368.6875,63624098.25,62562691.3125,61429539.25,60953533.5625,59544854.4375,84087693.8125,93743702.4375,100612893.5,100175200.688,98736065.75,94322586.375,91995250.1875,89242670.875,87499514.125,85709008.125,83668415.0625,82152740.1875,81427932.25,80021750.0,78584935.25,78061441.125,76154775.25,100641213.0,114712599.375,123395756.0,123223656.562,121449366.375,116587815.812,113704119.438,110559608.312,108449210.25,106168907.438,103815355.125,101995533.5,101195833.625,99470866.5,97695498.125,97139342.3125,94804509.5,118492738.812,136794997.25,147040276.562,147747892.75,145642100.125,140299736.625,137122821.312,133608593.438,131142149.0,128425450.188,125677369.062,123603254.062,122589303.25,120536015.312,118518929.625,117652261.062,114925132.062,137425690.188,160112130.5,172036298.312,173558512.75,171366776.75,165351896.75,162069360.875,158187475.688,155411474.25,152222157.938,148999587.875,146535990.438,145426222.625,143001938.25,140794237.375,139685475.188,136531269.75,157485482.562,184478256.438,198015527.0,200496643.312,198207266.312,191621629.812,188160810.375,183923439.438,180940243.812,177347583.375,173700716.75,170693936.438,169610035.812,166842019.312,164359903.0,162980706.0,159538387.812,178494890.812,209612381.75,224839001.688,228466908.688,225931103.25,218851455.875,215372468.25,210785850.125,207685320.188,203644500.438,199646647.562,195924052.25,194727105.875,191759129.75,188859731.062,187553810.0,183872016.188,200388412.938,235734635.688,252804574.312,257448780.75,254807217.875,247144858.062,243490311.938,238602178.875,235412385.312,231084765.312,226786420.812,222492722.688,221131060.25,218068285.812,214780657.812,213451665.688,209501928.938,223093573.625,262899030.75,281709237.75,287228121.75,284616128.875,276429883.75,272528596.938,267485284.0,263948574.75,259341994.25,254728332.75,250257213.125,248598360.125,245502693.438,241950835.688,240497706.5,236333304.375)
#cc <- cc/1000000
#Rio Grande -> 54\Reach -> Embalse Paloma
#cc <- c(132550274.25,149983484.875,163860671.938,163904747.938,160297899.875,150034545.25,142283994.75,134700737.188,129922698.562,124329005.062,119707279.188,115934481.0,112964274.25,109733505.25,106726026.062,104918056.5,101572668.562,164533445.0,190930479.75,211324770.812,213611612.812,210438394.5,198679841.25,189276860.188,179319920.562,172565575.438,165166277.875,159169854.562,154257853.688,150197689.438,145828737.625,141870237.0,139906826.875,135444910.438,201936447.0,240447189.75,269703020.625,275791489.688,270571894.875,254518517.75,242989907.75,230572492.312,222099404.438,212890507.438,205104691.375,198587101.812,193483116.625,188204813.625,183379119.562,180926433.688,175396923.25,247407841.188,302690868.438,340195210.125,351280619.188,345720957.438,325863140.375,309517562.312,292402618.062,280910795.125,268529266.25,258464533.688,249931958.375,243177703.125,235799132.75,229372851.25,225704736.938,218864955.0,302006893.938,370882823.75,415825560.438,432627075.312,428225548.375,405969262.688,387430561.688,367234036.625,352360110.25,335844475.312,322373984.0,311214189.75,302875164.812,292993777.5,284620122.812,279879396.375,270695234.125,360218961.312,442785778.125,495525918.125,518169689.5,515269156.25,491462520.188,471392838.312,448949756.5,432225422.625,413248557.438,396709979.875,382035513.062,371161054.438,358745809.562,348656731.875,342196616.688,331648168.0,421237074.375,517562353.812,578288737.562,607668065.188,605665168.062,580829817.625,559650984.812,535401952.562,517379334.188,496076815.062,477669326.875,460698288.188,447500717.875,432406813.812,419288228.625,411309801.5,398697171.375,484530808.812,595394054.375,664524903.938,700340331.875,699536221.5,674227772.688,651832860.688,625795912.375,606545156.0,583473989.25,563245758.75,544477278.75,529407775.812,513084405.812,497895711.75,487939067.688,473061888.562,550516139.125,676004838.625,753547615.5,796002826.688,796808044.375,771206857.812,747857740.812,720282917.625,699462563.562,674515861.125,652625557.625,632479685.25,615547569.25,598368586.0,581447859.562,570441071.438,554260607.062)
#cc <- cc/1000000
#Rio Hurtado -> 32\Reach -> Embalse Recoleta
#cc <- c(43375917.375,45316363.25,47531838.75,50617832.75,52595537.5,50385198.9375,47512692.1875,44827807.8125,41691948.625,39451016.0,37245414.5,35428748.6875,33562377.0,31962369.9375,30498704.4375,29492070.1875,28636220.1875,49071615.0,52145213.0,55699840.625,60385621.875,63802122.4375,61637357.25,58536121.4375,55452777.6875,51754844.375,49072118.875,46423029.9375,44135916.0,41890401.1875,39954304.1875,38190806.1875,37012873.625,35984289.625,55408346.125,59555085.5,64768295.8125,71067952.6875,75991241.0625,74020780.75,70711787.5,67355482.6875,63178339.8125,60072070.625,56965456.625,54406592.125,51714583.5625,49246237.4375,47274805.625,45836253.375,44651893.125,62217961.5625,67504256.9375,74488877.25,82454223.5,88960332.8125,87521399.625,83985957.9375,80474686.8125,75865825.375,72319974.5625,68699667.25,65812622.9375,62697884.6875,59894172.9375,57425206.9375,55736396.5625,54463653.8125,69560206.9375,75984290.4375,84691546.125,94865658.8125,102766377.688,101928037.875,98276614.625,94693738.6875,89606246.4375,85615394.125,81464080.5625,78197567.0625,74703778.6875,71525457.5,68618341.9375,66821057.1875,65258590.875,77399190.1875,85011028.9375,95344873.0625,108086679.688,117361925.25,117166656.562,113442368.188,109636465.812,104208056.188,99815542.625,95270681.0,91613208.1875,87717802.4375,84211829.875,80899759.5625,78881687.3125,77222708.25,85706876.75,94530035.0,106455611.25,121721004.312,132402813.125,132771891.75,129011824.688,125325399.625,119602736.938,115012716.25,110111284.062,106065529.812,101605043.062,97823903.375,94137046.8125,91839098.0625,90250171.3125,94337962.1875,104479064.375,117705741.5,135841326.0,147992524.062,148869866.625,145275041.312,141965832.688,135853135.375,131127521.812,125773226.938,121427614.625,116356984.875,112269939.438,108302036.25,105729495.5,104161996.438,103127503.625,114681973.5,129176896.438,150324878.25,164051598.625,165765653.812,162123433.938,159401402.125,152962458.062,148043565.938,142228519.688,137544964.0,132027119.625,127581921.812,123165033.312,120487996.5,118849616.188)
#cc <- cc/1000000
#Agua Potable - Litros
#cc <- c(0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0)
####Unmet Demand Litros
#cc <- c(24433707768.8,17987896231.2,15766205756.2,17558398493.8,20717297150.0,25379567781.2,30013706750.0,34862734581.2,38949865112.5,42731902712.5,46922311525.0,50629440962.5,54840830850.0,59737572137.5,64289731043.8,68230428156.2,71851223962.5,15078794887.5,9625691731.25,7984723325.0,9439845631.25,12848202675.0,16693921731.2,20662799931.2,24770904806.2,28786799318.8,32366391068.8,36797706412.5,40510560656.2,44601447387.5,49043194918.8,53468239800.0,57594363037.5,61313411381.2,9100610656.25,5321562768.75,3873223506.25,4996234562.5,6749992037.5,10239825075.0,13812898518.8,17718279062.5,21080628918.8,24583116031.2,28469405006.2,32191355825.0,36199649581.2,40692314150.0,44648704856.2,48428093743.8,52198289756.2,5482891425.0,3113820193.75,1745831875.0,2550368887.5,3618212750.0,6035689581.25,8680597143.75,11415995368.8,14194297437.5,17317113668.8,21629296081.2,25096853943.8,28858410137.5,33036486718.8,36990322225.0,40601635800.0,44068027781.2,3452645662.5,1916230800.0,820780612.5,1212311981.25,1984685156.25,3535143118.75,5587972681.25,7917014600.0,10088075443.8,12542404606.2,15177784037.5,18592615131.2,22274849825.0,26442828925.0,30297335137.5,33827056862.5,37261624812.5,2209314631.25,1116647918.75,418521256.25,554355450.0,1022890131.25,1936228925.0,3504232350.0,5533701200.0,7336408487.5,9556918637.5,12036814118.8,14548581825.0,17634266450.0,20781557381.2,24591768443.8,28026732343.8,31244394525.0,1383805581.25,577874050.0,194208387.5,218519287.5,431029768.75,1094361556.25,2254959306.25,3692997212.5,5459093762.5,7285030825.0,9309002462.5,11816133231.2,14415318912.5,17620949706.2,20482284725.0,23215811050.0,26224794631.2,818286775.0,329587831.25,94712706.25,89988887.5,173018387.5,528822781.25,1357317212.5,2475234200.0,3822076575.0,5610899387.5,7430342737.5,9483182775.0,11947872056.2,14786936106.2,17613457287.5,20108799918.8,22467235393.8,524930281.25,193561262.5,62795306.25,66836175.0,78205987.5,246437637.5,711692193.75,1684669456.25,2617930268.75,4150806450.0,5788740512.5,7740398218.75,9796951268.75,12450817031.2,14982853700.0,17489600225.0,19653029343.8)
####l to m3
#cc <- cc/1000
####m3 to thousand m3
#cc <- cc/1000


############Se genera grid#################################

elevation.df = data.frame(x = pp, y = tt, z = cc )
elevation.loess = loess(z ~ x*y, data = elevation.df, degree = 2, span = 0.5)
elevation.fit = expand.grid(list(x = seq(min(pp), max(pp)*.8, 0.1), y = seq(min(tt), max(tt), 0.01)))
z = predict(elevation.loess, newdata = elevation.fit)
elevation.fit$Height = as.numeric(z)


#Corresponde a la etiqueta, se vuelve a difinir tipo de puntos
key2 <- list(
  text=list(lab=c("Promedio Histórico","Promedio Proyectado (P95,P50,P5), Periodo 2030-260","Promedio Proyección CC 95, Periodo 2030 - 2060", "Promedio Proyección CC 50, Periodo 2030 - 2060", "Promedio Proyección CC 10, Periodo 2030 - 2060"), cex=0.9),
  lines=list(
    pch=c(4,19,0,1,2),
    col=1,
    type=c("p","p","p","p","p"),
    cex=1),
  space='bottom', rep= FALSE,
  rectangles=list(col=c("#08519d", "#f0f2ff"), size=3),
  text=list(c('Zona de Escasez [Mm³]','Zona de Normalidad [Mm³]'), cex = 0.8)
)



#Gráfico sin Línea
levelplot(Height ~ x*y, data = elevation.fit, aspect = 1, col.regions = colorRampPalette(c("#08519d", "#f0f2ff")), at=c(-2,quantile(cc, c(limite)),max(cc)*1.2),
          xlab = "Total Anual de Precipitación [mm]", ylab = "Temperatura Promedio [°C]",
          main = paste(var,"\n Volumen Embalsado [Mm³]"), key=key2,
           panel = function(x, y, subscripts, ...) {
            panel.levelplot(x, y, subscripts, ...)
            panel.xyplot(puntosx,puntosy , type=typos, cex = 1, col = 1, pch=pchpuntos)
            
          }
)

#Gráfico con Línea
levelplot(Height ~ x*y, data = elevation.fit, aspect = 1, col.regions = colorRampPalette(c("#08519d", "#f0f2ff")), at=c(-2,quantile(cc, c(limite)),max(cc)*1.2),
          xlab = "Total Anual de Precipitación [mm]", ylab = "Temperatura Promedio [°C]",
          main = paste(var,"\n Volumen Embalsado [Mm³]"), key=key2,
          panel = function(x, y, subscripts, ...) {
            panel.levelplot(x, y, subscripts, ...)
            panel.xyplot(puntosx,puntosy , type=typos, cex = 1, col = 1, pch=pchpuntos)
            panel.xyplot(puntosx[c(1,2)],puntosy[c(1,2)] , type=c("l","l"), cex = 0.5, col.line = "red", lwd=2.5, pch=pchpuntos)
          }
)

#Gráfico tres lineas

#corresponde a la coordenada X de los puntos 
puntosx <- c(167.473887814,promedioproyectadopp,p95.vectorpp,p50.vectorpp,p10.vectorpp,mean(as.numeric(p95.vectorpp)), mean(as.numeric(p50.vectorpp)), mean(as.numeric(p10.vectorpp)))
#corresponde a la coordenada Y de los puntos
puntosy <- c(16.8596276476,promedioproyectadott, p95.vectortt,p50.vectortt, p10.vectortt,mean(as.numeric(p95.vectortt)), mean(as.numeric(p50.vectortt)), mean(as.numeric(p10.vectortt)))

pchpuntos <- c(4,19,p95.phcpuntos,p50.phcpuntos,p10.phcpuntos,5,6,7)
typos <- c("p","p",p95.typos,p50.typos,p10.typos,"p","p","p")
nuevosx <- c(puntosx[c(1,1)],mean(as.numeric(p95.vectorpp)), mean(as.numeric(p50.vectorpp)), mean(as.numeric(p10.vectorpp)))
nuevosy <- c(puntosy[c(1,1)],mean(as.numeric(p95.vectortt)), mean(as.numeric(p50.vectortt)), mean(as.numeric(p10.vectortt)))

nuevo.promedio <- (mean(as.numeric(p95.vectortt))+mean(as.numeric(p50.vectortt))+mean(as.numeric(p10.vectortt)))/3
nuevo.promediopp <- (mean(as.numeric(p95.vectorpp))+mean(as.numeric(p50.vectorpp))+mean(as.numeric(p10.vectorpp)))/3


key2 <- list(
  text=list(lab=c("Promedio Histórico","Promedio Proyectado (P95,P50,P5), Periodo 2030-260","Promedio Proyecciones CC 95, Periodo 2030 - 2060", "Promedio Proyecciones CC 50, Periodo 2030 - 2060", "Promedio Proyecciones CC 10, Periodo 2030 - 2060", "Promedio P95, Periodo 2030-2060", "Promedio P50, Periodo 2030-2060", "Promedio P10, Periodo 2030-2060"), cex=0.9),
  lines=list(
    pch=c(4,19,0,1,2,5,6,7),
    col=1,
    type=c("p","p","p","p","p","p","p","p"),
    cex=1),
  space='bottom', rep= FALSE,
  rectangles=list(col=c("#08519d", "#f0f2ff"), size=3),
  text=list(c('Zona de Escasez [Mm³]','Zona de Normalidad [Mm³]'), cex = 0.8)
)

levelplot(Height ~ x*y, data = elevation.fit, aspect = 1, col.regions = colorRampPalette(c("#08519d", "#f0f2ff")), at=c(-2,quantile(cc, c(limite)),max(cc)*1.2),
          xlab = "Total Anual de Precipitación [mm]", ylab = "Temperatura Promedio [°C]",
          main = paste(var,"\n Volumen Embalsado [Mm³]"), key=key2,
          panel = function(x, y, subscripts, ...) {
            panel.levelplot(x, y, subscripts, ...)
            panel.xyplot(puntosx,puntosy , type=typos, cex = 1, col = 1, pch=pchpuntos)
            #panel.xyplot(puntosx[c(1,2)],puntosy[c(1,2)] , type=c("l","l"), cex = 0.5, col.line = "red", lwd=2.5, pch=pchpuntos)
            #mean
            panel.xyplot(c(167.4739,nuevo.promediopp),c(16.85963,nuevo.promedio) , type=c("l","l"), cex = 0.5, col.line = "red", lwd=1.5, pch=pchpuntos)
            #p10
            panel.xyplot(c(167.4739,mean(as.numeric(p10.vectorpp))),c(16.85963,mean(as.numeric(p10.vectortt))) , type=c("l","l"), cex = 0.5, col.line = "red", lwd=1.5, pch=pchpuntos)
            #p50
            panel.xyplot(c(167.4739,mean(as.numeric(p50.vectorpp))),c(16.85963,mean(as.numeric(p50.vectortt))) , type=c("l","l"), cex = 0.5, col.line = "red", lwd=1.5, pch=pchpuntos)
            #p95
            panel.xyplot(c(167.4739,mean(as.numeric(p95.vectorpp))),c(16.85963,mean(as.numeric(p95.vectortt))) , type=c("l","l"), cex = 0.5, col.line = "red", lwd=1.5, pch=pchpuntos)
            
          }
)



#Gráfico tres lineas vv2

#corresponde a la coordenada X de los puntos 
puntosx <- c(167.473887814,p95.vectorpp,p50.vectorpp,p10.vectorpp,mean(as.numeric(p95.vectorpp)), mean(as.numeric(p50.vectorpp)), mean(as.numeric(p10.vectorpp)))
#corresponde a la coordenada Y de los puntos
puntosy <- c(16.8596276476,p95.vectortt,p50.vectortt, p10.vectortt,mean(as.numeric(p95.vectortt)), mean(as.numeric(p50.vectortt)), mean(as.numeric(p10.vectortt)))

pchpuntos <- c(4,p95.phcpuntos,p50.phcpuntos,p10.phcpuntos,5,6,7)
typos <- c("p","p",p95.typos,p50.typos,p10.typos,"p","p","p")
nuevosx <- c(puntosx[c(1,1)],mean(as.numeric(p95.vectorpp)), mean(as.numeric(p50.vectorpp)), mean(as.numeric(p10.vectorpp)))
nuevosy <- c(puntosy[c(1,1)],mean(as.numeric(p95.vectortt)), mean(as.numeric(p50.vectortt)), mean(as.numeric(p10.vectortt)))

nuevo.promedio <- (mean(as.numeric(p95.vectortt))+mean(as.numeric(p50.vectortt))+mean(as.numeric(p10.vectortt)))/3
nuevo.promediopp <- (mean(as.numeric(p95.vectorpp))+mean(as.numeric(p50.vectorpp))+mean(as.numeric(p10.vectorpp)))/3


key2 <- list(
  text=list(lab=c("Promedio Histórico","Promedio Proyectado (P95,P50,P5), Periodo 2030-260","Promedio Proyecciones CC 95, Periodo 2030 - 2060", "Promedio Proyecciones CC 50, Periodo 2030 - 2060", "Promedio Proyecciones CC 10, Periodo 2030 - 2060", "Promedio P95, Periodo 2030-2060", "Promedio P50, Periodo 2030-2060", "Promedio P10, Periodo 2030-2060"), cex=0.9),
  lines=list(
    pch=c(4,0,1,2,5,6,7),
    col=1,
    type=c("p","p","p","p","p","p","p","p"),
    cex=1),
  space='bottom', rep= FALSE,
  rectangles=list(col=c("#08519d", "#f0f2ff"), size=3),
  text=list(c('Zona de Escasez [Mm³]','Zona de Normalidad [Mm³]'), cex = 0.8)
)

levelplot(Height ~ x*y, data = elevation.fit, aspect = 1, col.regions = colorRampPalette(c("#08519d", "#f0f2ff")), at=c(-2,quantile(cc, c(limite)),max(cc)*1.2),
          xlab = "Total Anual de Precipitación [mm]", ylab = "Temperatura Promedio [°C]",
          main = paste(var,"\n Volumen Embalsado [Mm³]"), key=key2,
          panel = function(x, y, subscripts, ...) {
            panel.levelplot(x, y, subscripts, ...)
            panel.xyplot(puntosx,puntosy , type=typos, cex = 1, col = 1, pch=pchpuntos)
            #panel.xyplot(puntosx[c(1,2)],puntosy[c(1,2)] , type=c("l","l"), cex = 0.5, col.line = "red", lwd=2.5, pch=pchpuntos)
            #mean
            #panel.xyplot(c(167.4739,nuevo.promediopp),c(16.85963,nuevo.promedio) , type=c("l","l"), cex = 0.5, col.line = "red", lwd=1.5, pch=pchpuntos)
            #p10
            panel.xyplot(c(167.4739,mean(as.numeric(p10.vectorpp))),c(16.85963,mean(as.numeric(p10.vectortt))) , type=c("l","l"), cex = 0.5, col.line = "red", lwd=1.5, pch=pchpuntos)
            #p50
            panel.xyplot(c(167.4739,mean(as.numeric(p50.vectorpp))),c(16.85963,mean(as.numeric(p50.vectortt))) , type=c("l","l"), cex = 0.5, col.line = "red", lwd=1.5, pch=pchpuntos)
            #p95
            panel.xyplot(c(167.4739,mean(as.numeric(p95.vectorpp))),c(16.85963,mean(as.numeric(p95.vectortt))) , type=c("l","l"), cex = 0.5, col.line = "red", lwd=1.5, pch=pchpuntos)
            
          }
)


#######Gráfico en xyz 10-02-2018
#generando una secuencia en el rango de los puntos x y replicamos en y con reg. lineal.


#generamos grafico
#plot(xaxis=c(100,200),yaxis=c(recta$z,0.7*quantile(cc, c(limite))), xlab="Precipitación [mm]", ylab="Volumen [Mm³]", type="n")
#setamos grafico
ww <- 0:10
plot(ww, xlim=c(200,100), ylim=c(150,500), xlab="Precipitación [mm]", ylab="Volumen [Mm³]", type="n")

#quantile
#lines(rev(recta$x), recta$z, type="l", lwd=2.5, col="blue")
lines(c(100,300),c(350,350), type="l", lwd=2.5,  col="red")
legend(150,520, legend=c("Límite Crítico","P10","P50","P95"), lty=c(1,1,1,1), col=c("red","#00204A","#005792","#00BBF0"), lwd=c(2.5,2.5,2.5,2.5))

title(var)

#promedio con 10
rangox <- c(mean(as.numeric(p10.vectorpp)),167.4739)
rangoy <- c(16.85963,mean(as.numeric(p10.vectortt)))
yy10 <- list()
xx <- seq(min(unlist(rangox))-40, max(unlist(rangox))+40, 0.5)

for (variable in 1:length(xx)) {
  yy10[variable] = lm(unlist(rangoy) ~ unlist(rangox))$coeff[[2]]*as.numeric(xx[variable])+lm(unlist(rangoy) ~ unlist(rangox))$coeff[[1]]
}
recta10 <- data.frame(x = as.numeric(xx), y = as.numeric(yy10))
recta10$x <- rev(recta10$x)
zz10 = predict(elevation.loess, newdata = recta10)
recta10$z = as.numeric(zz10)
lines(recta10$x, recta10$z, type="l", lwd=2.5, col="#00204A")

#promedio con 50
rangox <- c(mean(as.numeric(p50.vectorpp)),167.4739)
rangoy <- c(16.85963,mean(as.numeric(p50.vectortt)))
yy50 <- list()
xx <- seq(min(unlist(rangox))-40, max(unlist(rangox))+40, 0.5)
for (variable in 1:length(xx)) {
  yy50[variable] = lm(unlist(rangoy) ~ unlist(rangox))$coeff[[2]]*as.numeric(xx[variable])+lm(unlist(rangoy) ~ unlist(rangox))$coeff[[1]]
}
recta50 <- data.frame(x = as.numeric(xx), y = as.numeric(yy50))
recta50$x <- rev(recta50$x)
zz50 = predict(elevation.loess, newdata = recta50)
recta50$z = as.numeric(zz50)
#recta50$y = rev(recta50$y)
lines(recta50$x, recta50$z, type="l", lwd=2.5, col="#005792")

#promedio con 95
rangox <- c(mean(as.numeric(p95.vectorpp)),167.4739)
rangoy <- c(16.85963,mean(as.numeric(p95.vectortt)))
yy95 <- list()
xx <- seq(min(unlist(rangox))-40, max(unlist(rangox))+40, 0.5)
for (variable in 1:length(xx)) {
  yy95[variable] = lm(unlist(rangoy) ~ unlist(rangox))$coeff[[2]]*as.numeric(xx[variable])+lm(unlist(rangoy) ~ unlist(rangox))$coeff[[1]]
}
recta95 <- data.frame(x = as.numeric(xx), y = as.numeric(yy95))
recta95$x <- rev(recta95$x)
zz95 = predict(elevation.loess, newdata = recta95)
recta95$z = as.numeric(zz95)
#recta95$y = rev(recta95$y)
lines(recta95$x, recta95$z, type="l", lwd=2.5, col="#00BBF0")
lines(c(167.4739,167.4739),c(0,600), lty=2)
text(162,200,labels="P Promedio")


recta95 <- data.frame(x = c(160), y = c(18))
zz95 = predict(elevation.loess, newdata = recta95)

#generando los gráficos
#pp vs volumen
plot(range(recta$x),range(c(recta$z,0.7*quantile(cc, c(limite)))),xlab="Precipitación [mm]", ylab="Volumen [Mm³]", type="n")
lines(rev(recta$x), recta$z, type="l", lwd=2.5, col="blue")

#quantile
lines(c(min(recta$x),max(recta$x)),c(quantile(cc, c(limite)),quantile(cc, c(limite))), type="l", lwd=2.5,  col="red")
legend(min(recta$x)+(max(recta$x)-min(recta$x))/1.8, range(recta$z)[2], legend=c("Límite Crítico","Volumen"), lty=c(1,1), col=c("red","blue"), lwd=c(2.5,2.5))

title(var)
#temperatura vs volumen
plot(range(recta$y),range(c(recta$z,0.7*quantile(cc, c(limite)))),xlab="Temperatura [°C]", ylab="Volumen [Mm³]", type="n")
lines(recta$y, recta$z, type="l", lwd=2.5, col="blue")
title(var)
#quantile
lines(c(min(recta$y),max(recta$y)),c(quantile(cc, c(limite)),quantile(cc, c(limite))), type="l", lwd=2.5, col="red")
legend(min(recta$y)+(max(recta$y)-min(recta$y))/1.8, range(recta$z)[2], legend=c("Límite Crítico","Volumen"), lty=c(1,1), col=c("red","blue"), lwd=c(2.5,2.5))
###Fin de modificación

#nuevo grafico
#######Gráfico en xyz 10-02-2018
#generando una secuencia en el rango de los puntos x y replicamos en y con reg. lineal.
yy <- list()
xx <- seq(50, 250, 0.05)
for (variable in 1:length(xx)) {
  yy[variable] = 14
}
recta <- data.frame(x = as.numeric(xx), y = as.numeric(yy))
zz = predict(elevation.loess, newdata = recta)
recta$z = as.numeric(zz)
recta <- recta[complete.cases(recta), ]

#buscando stress limite
recta[which(abs(recta$z-330)==min(abs(recta$z-330))),]
#generando los gráficos
#pp vs volumen
plot(recta$x,recta$z,xaxs = "i", xlim=c(max(recta$x),min(recta$x)), col="blue", type = "l", lwd = 2.5, xlab="Precipitación [mm]", ylab="Volumen [Mm³]", main="Embalse Paloma T=18°C")
lines(c(max(recta$x),min(recta$x)),c(quantile(cc, c(limite)),quantile(cc, c(limite))), type="l", lwd=2.5,  col="red")
#limite crítico
lines(c(150,150),c(0,330), lty=2)
text(210,500,labels="ΔV")

arrows(200,352, 200,580, xpd = TRUE, code = 3, lty=2)
arrows(237,250, 150,250, xpd = TRUE, code = 3, lty=2)
text(200,200,labels="ΔP")








#########nuevo grafico todo incluido##############

yy <- list()
xx <- seq(50, 250, 0.05)
for (variable in 1:length(xx)) {
  yy[variable] = 16.85963
}
recta <- data.frame(x = as.numeric(xx), y = as.numeric(yy))
zz = predict(elevation.loess, newdata = recta)
recta$z = as.numeric(zz)
recta <- recta[complete.cases(recta), ]

#buscando stress limite
recta[which(abs(recta$z-330)==min(abs(recta$z-330))),]
#generando los gráficos
#pp vs volumen
plot(recta$x,recta$z,xaxs = "i", xlim=c(210,120), col="blue", type = "l", lwd = 2.5, xlab="Precipitación [mm]", ylab="Volumen [Mm³]", main="Embalse Paloma T=16.86°C")
#lines(c(max(recta$x),min(recta$x)),c(quantile(cc, c(limite)),quantile(cc, c(limite))), type="l", lwd=2.5,  col="red")
#limite crítico
lines(c(150,150),c(0,330), lty=2)
text(195,500,labels="ΔV")

arrows(200,332, 200,600, xpd = TRUE, code = 3, lty=2)
arrows(210,250, 150,250, xpd = TRUE, code = 3, lty=2)
text(200,200,labels="ΔP")
#ww <- 1:10
#plot(ww, xlim=c(200,100), ylim=c(150,500), xlab="Precipitación [mm]", ylab="Volumen [Mm³]", type="n")

#quantile
#lines(rev(recta$x), recta$z, type="l", lwd=2.5, col="blue")

legend("topright", legend=c("Límite Crítico","P10","P50","P95","Tprom"), lty=c(1,1,1,1,1), col=c("red","#00204A","#005792","#00BBF0","blue"), lwd=c(2.5,2.5,2.5,2.5), cex=0.7)

#title(var)

#promedio con 10
rangox <- c(mean(as.numeric(p10.vectorpp)),167.4739)
rangoy <- c(16.85963,mean(as.numeric(p10.vectortt)))
yy10 <- list()
xx <- seq(min(unlist(rangox))-100, max(unlist(rangox))+100, 0.5)

for (variable in 1:length(xx)) {
  yy10[variable] = lm(unlist(rangoy) ~ unlist(rangox))$coeff[[2]]*as.numeric(xx[variable])+lm(unlist(rangoy) ~ unlist(rangox))$coeff[[1]]
}
recta10 <- data.frame(x = as.numeric(xx), y = as.numeric(yy10))
recta10$x <- rev(recta10$x)
zz10 = predict(elevation.loess, newdata = recta10)
recta10$z = as.numeric(zz10)
lines(recta10$x, recta10$z, type="l", lwd=2.5, col="#00204A")

#promedio con 50
rangox <- c(mean(as.numeric(p50.vectorpp)),167.4739)
rangoy <- c(16.85963,mean(as.numeric(p50.vectortt)))
yy50 <- list()
xx <- seq(min(unlist(rangox))-100, max(unlist(rangox))+100, 0.5)
for (variable in 1:length(xx)) {
  yy50[variable] = lm(unlist(rangoy) ~ unlist(rangox))$coeff[[2]]*as.numeric(xx[variable])+lm(unlist(rangoy) ~ unlist(rangox))$coeff[[1]]
}
recta50 <- data.frame(x = as.numeric(xx), y = as.numeric(yy50))
recta50$x <- rev(recta50$x)
zz50 = predict(elevation.loess, newdata = recta50)
recta50$z = as.numeric(zz50)
#recta50$y = rev(recta50$y)
lines(recta50$x, recta50$z, type="l", lwd=2.5, col="#005792")

#promedio con 95
rangox <- c(mean(as.numeric(p95.vectorpp)),167.4739)
rangoy <- c(16.85963,mean(as.numeric(p95.vectortt)))
yy95 <- list()
xx <- seq(min(unlist(rangox))-100, max(unlist(rangox))+100, 0.5)
for (variable in 1:length(xx)) {
  yy95[variable] = lm(unlist(rangoy) ~ unlist(rangox))$coeff[[2]]*as.numeric(xx[variable])+lm(unlist(rangoy) ~ unlist(rangox))$coeff[[1]]
}
recta95 <- data.frame(x = as.numeric(xx), y = as.numeric(yy95))
recta95$x <- rev(recta95$x)
zz95 = predict(elevation.loess, newdata = recta95)
recta95$z = as.numeric(zz95)
#recta95$y = rev(recta95$y)
lines(recta95$x, recta95$z, type="l", lwd=2.5, col="#00BBF0")
lines(c(167.4739,167.4739),c(0,450), lty=2)
text(160,520,labels="P Promedio")

#350 es el limite de embalse
lines(c(100,300),c(330,330), type="l", lwd=2.5,  col="red")
